<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Fast separable filters for associative operations · LocalFilters.jl Package</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">LocalFilters.jl Package</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../generic/">Generic local filters</a></li><li><a class="tocitem" href="../neighborhoods/">Neighborhoods, structuring elements, and kernels</a></li><li><a class="tocitem" href="../linear/">Linear filters</a></li><li><a class="tocitem" href="../nonlinear/">Non-linear filters</a></li><li><a class="tocitem" href="../morphology/">Non-linear morphological filters</a></li><li class="is-active"><a class="tocitem" href>Fast separable filters for associative operations</a><ul class="internal"><li><a class="tocitem" href="#Out-of-place-version"><span>Out-of-place version</span></a></li><li><a class="tocitem" href="#In-place-version"><span>In-place version</span></a></li><li><a class="tocitem" href="#Examples"><span>Examples</span></a></li><li><a class="tocitem" href="#Efficiency-and-restrictions"><span>Efficiency and restrictions</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Fast separable filters for associative operations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Fast separable filters for associative operations</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/emmt/LocalFilters.jl/blob/master/docs/src/separable.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Fast-separable-filters-for-associative-operations"><a class="docs-heading-anchor" href="#Fast-separable-filters-for-associative-operations">Fast separable filters for associative operations</a><a id="Fast-separable-filters-for-associative-operations-1"></a><a class="docs-heading-anchor-permalink" href="#Fast-separable-filters-for-associative-operations" title="Permalink"></a></h1><p>When the filter amounts to combining all elements in a rectangular neighborhood by an associative binary operation (<code>+</code>, <code>min</code>, <code>max</code>, <em>etc.</em>), the van Herk-Gil-Werman algorithm can be used to implement the filter.  This algorithm is much faster than a naive implementation (about <code>3N</code> operations per element for a <code>N</code>-dimensional array whatever the size of the neighborhood instead of <code>p^N - 1</code> operations for a neighborhood of lenght <code>p</code> along all the <code>N</code> dimensions).  Another advantage of the van Herk-Gil-Werman algorithm is that it can be applied in-place.  Such a filter is said to be <em>separable</em> and can be applied along each dimension, one at a time.</p><h2 id="Out-of-place-version"><a class="docs-heading-anchor" href="#Out-of-place-version">Out-of-place version</a><a id="Out-of-place-version-1"></a><a class="docs-heading-anchor-permalink" href="#Out-of-place-version" title="Permalink"></a></h2><p>The van Herk-Gil-Werman algorithm is used by the <a href="../reference/#LocalFilters.localfilter"><code>localfilter</code></a> method when called as:</p><pre><code class="language-julia hljs">localfilter([T=eltype(A),] A, dims, op, rngs [, wrk]) -&gt; dst</code></pre><p>yields the result of applying van Herk-Gil-Werman algorithm to filter array <code>A</code> along dimension(s) <code>dims</code> with (associative) binary operation <code>op</code> and contiguous structuring element(s) defined by the interval(s) <code>rngs</code>.  Optional argument <code>wrk</code> is a workspace array which is automatically allocated if not provided; otherwise, it must be a vector with the same element type as <code>A</code> and it is resized as needed (by calling the <code>resize!</code> method).  The optional argument <code>T</code> allows to specify another type of element than <code>eltype(A)</code> for the result.</p><p>Argument <code>dims</code> specifies along which dimension(s) of <code>A</code> the filter is to be applied, it can be a single integer, a tuple of integers, or a colon <code>:</code> to apply the operation to all dimensions.  Dimensions are processed in the order given by <code>dims</code> (the same dimension may appear several times) and there must be a matching interval in <code>rngs</code> to specify the structuring element (except that if <code>rngs</code> is a single interval, it is used for every dimension in <code>dims</code>).  An interval is either an integer or an integer valued unit range in the form <code>kmin:kmax</code> (an interval specified as a single integer, say <code>k</code>, is the same as specifying <code>k:k</code>).</p><p>Assuming a mono-dimensional array <code>A</code>, the single filtering pass:</p><pre><code class="language-julia hljs">dst = localfilter(A, :, op, rng)</code></pre><p>amount to computing:</p><pre><code class="language-julia hljs">dst[j] = A[j-kmax] ⋄ A[j-kmax+1] ⋄ A[j-kmax+2] ⋄ ... ⋄ A[j-kmin]</code></pre><p>for all <code>j ∈ [first(axes(A,1)):last(axes(A,1))]</code>, with <code>x ⋄ y = op(x, y)</code>, <code>kmin = first(rng)</code> and <code>kmax = last(rng)</code>.  Note that if <code>kmin = kmax = k</code> (which occurs if <code>rng</code> is a simple integer), the result of the filter is to operate a simple shift by <code>k</code> along the corresponding dimension and has no effects if <code>k = 0</code>.  This can be exploited to not filter some dimension(s).</p><h2 id="In-place-version"><a class="docs-heading-anchor" href="#In-place-version">In-place version</a><a id="In-place-version-1"></a><a class="docs-heading-anchor-permalink" href="#In-place-version" title="Permalink"></a></h2><p>The <a href="../reference/#LocalFilters.localfilter!"><code>localfilter!</code></a> method implement the <em>in-place</em> version of the van Herk-Gil-Werman algorithm:</p><pre><code class="language-julia hljs">localfilter!([dst = A,] A, dims, op, rngs [, wrk]) -&gt; dst</code></pre><p>overwrites the contents of <code>dst</code> with the result of the filter and returns <code>dst</code>.  The destination array <code>dst</code> must have the same indices as the source <code>A</code> (that is, <code>axes(dst) == axes(A)</code>).  If <code>dst</code> is not specified or if <code>dst</code> is <code>A</code>, the operation is performed in-place.</p><h2 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h2><p>The <em>morphological erosion</em> (local minimum) of the array <code>A</code> on a centered structuring element of width 7 in every dimension can be obtained by:</p><pre><code class="nohighlight hljs">localfilter(A, :, min, -3:3)</code></pre><p>Array <code>A</code> can be used <em>in-place</em> for the same operation:</p><pre><code class="language-julia hljs">localfilter!(A, :, min, -3:3)</code></pre><p>Index interval <code>0:0</code> may be specified to do nothing along the corresponding dimension.  For instance, assuming <code>A</code> is a three-dimensional array:</p><pre><code class="language-julia hljs">localfilter!(A, :, max, (-3:3, 0:0, -4:4))</code></pre><p>overwrites <code>A</code> by its <em>morphological dilation</em> (<em>i.e.</em> local maximum) in a centered local neighborhood of size <code>7×1×9</code> (nothing is done along the second dimension).  The same result may be obtained with:</p><pre><code class="language-julia hljs">localfilter!(A, (1,3), max, (-3:3, -4:4))</code></pre><p>where the second dimension is omitted from the list of dimensions.</p><p>The <em>local average</em> of the two-dimensional array <code>A</code> on a centered moving window of size 11×11 can be computed as:</p><pre><code class="language-julia hljs">localfilter(A, :, +, (-5:5, -5:5))*(1/11)</code></pre><h2 id="Efficiency-and-restrictions"><a class="docs-heading-anchor" href="#Efficiency-and-restrictions">Efficiency and restrictions</a><a id="Efficiency-and-restrictions-1"></a><a class="docs-heading-anchor-permalink" href="#Efficiency-and-restrictions" title="Permalink"></a></h2><p>The van Herk-Gil-Werman algorithm is very fast for rectangular structuring elements.  It takes at most 3 operations to filter an element along a given dimension whatever the width <code>p</code> of the considered local neighborhood.  For <code>N</code>-dimensional arrays, the algorithm requires only <code>3N</code> operations per element instead of <code>p^N - 1</code> operations for a naive implementation.  This however requires to make a pass along each dimension so <a href="https://en.wikipedia.org/wiki/Page_fault">memory page faults</a> may reduce the performances. This is somewhat attenuated by the fact that the algorithm can be applied in-place.  For efficient multi-dimensional out-of-place filtering, it is recommended to make the first pass with a fresh destination array and then all other passes in-place on the destination array.</p><p>To apply the van Herk-Gil-Werman algorithm, the structuring element must be separable along the dimensions and its components must be contiguous.  In other words, the algorithm is only applicable for <code>N</code>-dimensional rectangular neighborhoods, so-called <em>hyperrectangles</em>.  The structuring element may however be off-centered by arbitrary offsets along each dimension.</p><p>To take into account boundary conditions (for now, only nearest neighbor is implemented) and allow for in-place operation, the algorithm allocates a workspace array.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ul><li><p>Marcel van Herk, &quot;<em>A fast algorithm for local minimum and maximum filters on rectangular and octagonal kernels</em>&quot; in Pattern Recognition Letters <strong>13</strong>, 517-521 (1992).</p></li><li><p>Joseph Gil and Michael Werman, &quot;<em>Computing 2-D Min, Median, and Max Filters</em>&quot; in IEEE Transactions on Pattern Analysis and Machine Intelligence <strong>15</strong>, 504-507 (1993).</p></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../morphology/">« Non-linear morphological filters</a><a class="docs-footer-nextpage" href="../reference/">Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.19 on <span class="colophon-date" title="Monday 13 June 2022 07:11">Monday 13 June 2022</span>. Using Julia version 1.6.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
